<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einstein AR Experience</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div id="loading">
        Loading AR Experience... <br>
        Please allow camera access when prompted.
    </div>

    <a-scene 
        embedded 
        vr-mode-ui="enabled: false"
        arjs='sourceType: webcam; debugUIEnabled: false;' 
        renderer="logarithmicDepthBuffer: true;">

        <a-nft 
            id="einstein-marker"
            type="nft" 
            url="markers/einstein" 
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5">
            
            <a-entity
                id="einstein-model"
                gltf-model="url(models/einstein.glb)"
                scale="0.5 0.5 0.5"
                position="0 0.5 0"
                rotation="0 180 0"
                animation="property: rotation; to: 0 540 0; loop: true; dur: 10000"
                visible="false"
            >
            </a-entity>

            <a-box 
                id="red-square"
                position="0 0 0"       scale="1 1 0.01"        color="red"
                opacity="0.5"           visible="false"         ></a-box>

        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Get references to the elements
        const loadingElement = document.getElementById('loading');
        const marker = document.querySelector('#einstein-marker');
        const model = document.querySelector('#einstein-model');
        const redSquare = document.querySelector('#red-square'); // Get reference to the red square

        // Hide the loading message once the scene is loaded
        document.querySelector('a-scene').addEventListener('loaded', function() {
            // Hide loading message with a delay to ensure AR is ready
            setTimeout(() => { 
                loadingElement.style.display = 'none'; 
            }, 2000);
        });

        // Show the model AND the red square when the marker is found
        marker.addEventListener('markerFound', (e) => {
            console.log("Einstein marker found!");
            model.setAttribute('visible', 'true');
            redSquare.setAttribute('visible', 'true'); // Make the red square visible
        });

        // Hide the model AND the red square when the marker is lost
        marker.addEventListener('markerLost', (e) => {
            console.log("Einstein marker lost.");
            model.setAttribute('visible', 'false');
            redSquare.setAttribute('visible', 'false'); // Hide the red square
        });

        // Handle errors (like no camera access)
        marker.addEventListener('error', (e) => {
            console.error("AR Error:", e.detail);
            loadingElement.innerHTML = "Error: " + e.detail.error + "<br>Please check console for details.";
        });
    </script>
</body>
</html>